# HealthSync ‚Äì Sprint 4 (Oracle) ¬∑ Hospital das Cl√≠nicas

> App de console em Python com persist√™ncia Oracle: **Pacientes** e **Teleconsultas**, exporta√ß√£o **JSON** e consumo de **API p√∫blica (ViaCEP)**.

**Integrantes**
- **Maicon Douglas** ‚Äî RM **561279**
- **Laura Lopes** ‚Äî RM **566376**
- **Richard Freitas** ‚Äî RM **566127**

---

## ‚ö° TL;DR ‚Äî Passos r√°pidos para rodar

> Testado em Windows 10/11 e compat√≠vel com macOS/Linux (ajuste os comandos do terminal conforme seu SO).

1. **Pr√©‚Äërequisitos**
   - **Python 3.11+** (`python --version`)
   - Acesso de rede ao Oracle da FIAP (`oracle.fiap.com.br:1521`)
   - (Opcional) **Oracle Instant Client** para Modo Thick

2. **Clone e entre no projeto**
   ```powershell
   git clone <URL_DO_REPO>
   cd <PASTA_DO_REPO>
   ```

3. **Crie e ative um ambiente virtual**
   - **Windows (PowerShell)**
     ```powershell
     py -3.11 -m venv .venv
     .\.venv\Scripts\Activate.ps1
     ```
   - **macOS/Linux (bash/zsh)**
     ```bash
     python3 -m venv .venv
     source .venv/bin/activate
     ```

4. **Instale depend√™ncias**
   ```bash
   pip install -r requirements.txt
   ```

5. **Crie o arquivo `.env` (credenciais do Oracle)**  
   Crie um arquivo `.env` na raiz com **seus dados**:
   ```dotenv
   USER=SEU_USUARIO_ORACLE
   PASSWORD=SUA_SENHA_ORACLE
   HOST=oracle.fiap.com.br
   PORT=1521
   SID=orcl
   # Opcional para Modo Thick (Windows exemplo):
   # INSTANT_CLIENT=C:\instantclient-basic-windows.x64-23.9.0.25.07\instantclient_23_9
   ```

6. **Teste r√°pido de conex√£o**
   ```bash
   python quick_check.py
   ```
   Sa√≠da esperada (ex.): `Conex√£o OK: (1,)`

7. **Crie as tabelas no Oracle**
   ```bash
   python src/create_tables.py
   ```

8. **(Opcional) Popular com dados de exemplo (idempotente)**
   ```bash
   python src/seed_data.py
   ```

9. **Rodar o sistema (menus CRUD, export JSON, ViaCEP)**
   ```bash
   python src/hs_app.py
   ```

10. **(Opcional) Limpar o ambiente (apaga tabelas)**
    ```bash
    python src/drop_tables.py
    ```

---

## üß± Estrutura (vis√£o geral)

```
.
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env                      # (n√£o versionar) credenciais Oracle
‚îú‚îÄ‚îÄ quick_check.py            # teste m√≠nimo de conex√£o
‚îú‚îÄ‚îÄ sql/
‚îÇ   ‚îú‚îÄ‚îÄ create_tables.sql     # DDL das tabelas
‚îÇ   ‚îî‚îÄ‚îÄ drop_tables.sql       # drop e purge das tabelas
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ connection_functions.py  # CRUD_Connect: centraliza conex√£o e cursores
    ‚îú‚îÄ‚îÄ create_tables.py         # executa cria√ß√£o das tabelas
    ‚îú‚îÄ‚îÄ drop_tables.py           # executa remo√ß√£o das tabelas
    ‚îú‚îÄ‚îÄ export_json.py           # exporta JSON de consultas
    ‚îú‚îÄ‚îÄ external_api.py          # consumo ViaCEP (API p√∫blica)
    ‚îú‚îÄ‚îÄ hs_app.py                # app principal (menus/submenus)
    ‚îú‚îÄ‚îÄ seed_data.py             # popular dados (idempotente)
    ‚îî‚îÄ‚îÄ utils.py                 # helpers: .env, parsing de datas, etc.
```

---

## üìÑ SQL ‚Äì O que h√° nos arquivos

### `sql/create_tables.sql`
Cria o schema m√≠nimo do HealthSync:
- **HS_PACIENTE**  
  - `ID` ‚Äî `NUMBER GENERATED AS IDENTITY` (PK)  
  - `NOME` ‚Äî `VARCHAR2(120)`  
  - `NASCIMENTO` ‚Äî `DATE`  
  - `TELEFONE` ‚Äî `VARCHAR2(20)`  
  - `ALTA` ‚Äî `CHAR(1)` com `CHECK (ALTA IN ('S','N'))`, default `N`
- **HS_TELECONSULTA**  
  - `ID` ‚Äî `NUMBER GENERATED AS IDENTITY` (PK)  
  - `PACIENTE_ID` ‚Äî FK ‚Üí `HS_PACIENTE(ID)` (ON DELETE RESTRICT)  
  - `MEDICO` ‚Äî `VARCHAR2(120)`  
  - `DATA_HORA` ‚Äî `DATE` (armazenando data+hora)  
  - `DIAGNOSTICO` ‚Äî `VARCHAR2(200)`  
  - `URGENCIA` ‚Äî `VARCHAR2(10)` com `CHECK IN ('baixa','media','alta')`  
  - `ELEGIVEL_ONLINE` ‚Äî `CHAR(1)` com `CHECK IN ('S','N')`  
  - `STATUS` ‚Äî `VARCHAR2(20)` com `CHECK IN ('agendada','em_andamento','concluida','cancelada')`  
  - `PLANO` ‚Äî `VARCHAR2(400)` (opcional)

Tamb√©m podem existir **√≠ndices auxiliares** (ex.: `IDX_TC_PAC`, `IDX_TC_DT`).

### `sql/drop_tables.sql`
Remove as tabelas, em ordem de depend√™ncia, com `PURGE` quando suportado:
- `DROP TABLE HS_TELECONSULTA PURGE;`
- `DROP TABLE HS_PACIENTE PURGE;`

---

## üêç Python ‚Äì Resumo de cada script

### `src/create_tables.py`
- L√™ as credenciais do `.env`, abre conex√£o (via `CRUD_Connect`) e executa o DDL de cria√ß√£o das tabelas.
- Pode ler de `sql/create_tables.sql` ou usar DDL embutido (conforme sua vers√£o do projeto).  
- **Uso:** `python src/create_tables.py`

### `src/drop_tables.py`
- Remove as tabelas do schema do projeto em ordem correta (Teleconsulta ‚Üí Paciente).  
- **Uso:** `python src/drop_tables.py`

### `src/export_json.py`
- Executa **consultas SELECT** e exporta resultados para a pasta `exports/` em:
  - `pacientes.json`  
  - `teleconsultas.json`  
  - `teleconsultas_join.json` (join paciente + teleconsulta)
- √ötil para evidenciar o requisito de **exporta√ß√£o**.  
- **Uso isolado:** `python src/export_json.py`  
  - (Tamb√©m √© invocado a partir do menu do `hs_app.py`.)

### `src/external_api.py`
- Exemplo de **consumo de API p√∫blica (ViaCEP)** com `requests`:
  - Fun√ß√£o `consultar_cep(cep: str)` ‚Üí retorna JSON do ViaCEP.
- **Uso isolado:** `python src/external_api.py 01001000`  
  - (Tamb√©m √© invocado pelo menu ‚ÄúRelat√≥rios e Integra√ß√µes‚Äù.)

### `src/hs_app.py`  üëâ **Aplica√ß√£o principal (console)**
- Apresenta **menus e submenus**:
  - **Pacientes:** cadastrar, listar, atualizar, excluir, conceder alta  
    - *Regra:* impedir exclus√£o de paciente que possua teleconsultas vinculadas.
  - **Teleconsultas:** agendar, listar, atualizar, excluir, concluir sess√£o  
    - ‚ÄúConcluir‚Äù permite incluir orienta√ß√µes finais no plano.
  - **Relat√≥rios e Integra√ß√µes:** exportar JSON + consultar CEP (ViaCEP)
- Realiza **valida√ß√µes b√°sicas** e mensagens claras (sucesso/erro).
- **Uso:** `python src/hs_app.py`

### `src/seed_data.py`
- **Popularizador idempotente**: cria alguns pacientes e teleconsultas **s√≥ se ainda n√£o existirem**.
- Ajuda a ter dados previs√≠veis para demonstra√ß√£o e testes.  
- **Uso:** `python src/seed_data.py`

### `quick_check.py`
- Teste m√≠nimo do ambiente:
  - imprime vers√£o do Python, `oracledb` e modo (Thin/Thick),
  - tenta conectar e faz `SELECT 1 FROM dual`.
- **Uso:** `python quick_check.py`

### `src/utils.py`
- Fun√ß√µes utilit√°rias comuns ao projeto:
  - `get_credentials()` ‚Äî l√™ `.env` e devolve `(USER, PASSWORD)`
  - `parse_date_br("dd/mm/aaaa")` ‚Üí `datetime.date`
  - `parse_datetime_br("dd/mm/aaaa HH:MM")` ‚Üí `datetime.datetime`
  - normaliza√ß√µes e helpers de formata√ß√£o

> **Observa√ß√£o:** a conex√£o Oracle √© centralizada em `connection_functions.py` (retorna **cursores de Create/Read/Update/Delete** + conex√£o). Isso desacopla a persist√™ncia do restante da aplica√ß√£o.

---

## üîê `.env` ‚Äî Configura√ß√£o de ambiente

Crie na **raiz** um arquivo `.env` (n√£o commit!) com:

```dotenv
USER=SEU_USUARIO_ORACLE
PASSWORD=SUA_SENHA_ORACLE
HOST=oracle.fiap.com.br
PORT=1521
SID=orcl

# (Opcional) Para Modo Thick:
# INSTANT_CLIENT=C:\instantclient-basic-windows.x64-23.9.0.25.07\instantclient_23_9
```

- Se `INSTANT_CLIENT` **n√£o** for definido, o driver usa **Modo Thin** (n√£o precisa instalar o Instant Client).
- Em **Windows**, se usar Thick, confirme o caminho correto do Instant Client.
- N√£o exponha o `.env` publicamente.

---

## üì¶ `requirements.txt`

```txt
oracledb
python-dotenv
requests
pandas
```

- `oracledb` ‚Äî driver oficial Oracle para Python (Thin/Thick)
- `python-dotenv` ‚Äî leitura do `.env`
- `requests` ‚Äî consumo da API ViaCEP
- `pandas` ‚Äî apoio a listagens/exporta√ß√µes (opcional, mas √∫til)

Instala√ß√£o:

```bash
pip install -r requirements.txt
```

---

## üß≠ Fluxo t√≠pico de uso

1. `python quick_check.py` ‚Äî validar conex√£o e driver  
2. `python src/create_tables.py` ‚Äî criar tabelas  
3. `python src/seed_data.py` ‚Äî popular (opcional, idempotente)  
4. `python src/hs_app.py` ‚Äî navegar pelos menus e testar CRUD / export / ViaCEP  
5. `python src/drop_tables.py` ‚Äî limpar ambiente (opcional)

---

## üñ•Ô∏è (Opcional) Como seria um **Front‚ÄëEnd** para apresentar o projeto

Para uma apresenta√ß√£o visual, poder√≠amos expor uma **API REST** em Python (ex.: **FastAPI**/**Flask**) por cima da l√≥gica atual e construir um **front React** (ou outro).

**Poss√≠vel API (exemplos):**
- `GET /api/pacientes` ‚Äî lista pacientes
- `POST /api/pacientes` ‚Äî cria paciente
- `PUT /api/pacientes/{id}` ‚Äî atualiza paciente
- `DELETE /api/pacientes/{id}` ‚Äî remove paciente (bloquear se houver teleconsulta)
- `GET /api/teleconsultas` ‚Äî lista teleconsultas (filtros: paciente_id, status)
- `POST /api/teleconsultas` ‚Äî cria teleconsulta
- `PATCH /api/teleconsultas/{id}/concluir` ‚Äî conclui sess√£o
- `GET /api/export/pacientes|teleconsultas|join` ‚Äî baixa JSON
- `GET /api/cep/{cep}` ‚Äî proxy para ViaCEP

**Front (ex.: React + Vite + TS + Tailwind):**
- **Pacientes:** tabela + modal/cadastro/edi√ß√£o; busca por nome/telefone; indicador de ‚ÄúAlta‚Äù
- **Teleconsultas:** tabela, filtros (status, urg√™ncia), cria√ß√£o/edi√ß√£o, a√ß√£o ‚ÄúConcluir‚Äù (adiciona orienta√ß√µes)
- **Exporta√ß√µes:** bot√µes ‚ÄúBaixar JSON‚Äù
- **CEP:** campo para consultar e auto-preencher endere√ßo (se aplic√°vel)

Isso manteria a **mesma regra de neg√≥cio** do console, apenas com uma **camada HTTP** para integra√ß√£o visual.

---

## üß© Dicas e Troubleshooting

- `ORA-01017: invalid username/password` ‚Üí revise `USER/PASSWORD` no `.env`
- `ORA-12541: TNS:no listener` / timeout ‚Üí revise `HOST/PORT/SID` e conectividade de rede
- `DPI-1047: Cannot locate a 64-bit Oracle Client` ‚Üí voc√™ pediu Modo Thick (tem `INSTANT_CLIENT`) mas o caminho √© inv√°lido; ajuste o `.env` **ou** remova a vari√°vel para usar Modo Thin
- `PermissionError` em Windows ao ativar venv ‚Üí abra PowerShell **como administrador** e rode:
  ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
  ```

---

## üìö Licen√ßa
Uso acad√™mico ‚Äì FIAP ¬∑ HealthSync ‚Ä¢ 2025.
